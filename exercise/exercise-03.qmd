---
title: "üî® Working with R"
subtitle: "Session 03 - Showcase "
date: last-modified
date-format: "DD.MM.YYYY"
---

::: {.callout-tip icon="false"}
![Quarto Slides](https://raw.githubusercontent.com/faucommsci/teaching_materials/refs/heads/main/images/badges/badge-quarto-slide.svg) Link to slides

![](https://raw.githubusercontent.com/faucommsci/teaching_materials/refs/heads/main/images/badges/badge-quarto_document.svg) Download source file

![](https://raw.githubusercontent.com/faucommsci/teaching_materials/refs/heads/main/images/badges/badge-binder_rstudio.svg) Open this exercise in interactive and executable environment
:::

## Background

-   The best way to learn R is by trying. This document tries to display a version of the "normal" data processing procedure.
-   Use `tidytuesday` data as an example to showcase the potential

::: callout-note
## Todays's data basis: Hollywood Age Gaps

> An informational site showing the age gap between movie love interests.

The data follows certain rules:

-   The two (or more) actors play actual love interests (not just friends, coworkers, or some other non-romantic type of relationship)
-   The youngest of the two actors is at least 17 years old
-   Not animated characters
:::

## Packages

-   The `pacman::p_load()` package is used to load the packages, which has several advantages over the conventional method with `library()`:

  -   Concise syntax
  -   Automatic installation (if the package is not already installed)
  -   Loading multiple packages at once
  -   Automatic search for dependencies

```{r load-packages}
pacman::p_load(
  here, 
  magrittr, 
  tidyverse,
  janitor,
  easystats,
  sjmisc,
  ggpubr)
```

## Import data

| Variable | Description |
|:-------------------------|:---------------------------------------------|
| `movie_name` | Name of the film |
| `release_year` | Release year |
| `director` | Director of the film |
| `age_difference` | Age difference between the characters in whole years |
| `couple_number` | An identifier for the couple in case multiple couples are listed for this film |
| `actor_1_name` | The name of the older actor in this couple |
| `actor_2_name` | The name of the younger actor in this couple |
| `actor_1_birthdate` | The birthdate of the older member of the couple |
| `actor_2_birthdate` | The birthdate of the younger member of the couple |
| `actor_1_age` | The age of the older actor when the film was released |
| `actor_2_age` | The age of the younger actor when the film was released |

: Variablennamen und -beschreibungen

```{r import-data-raw}
# Import data from URL
age_gaps <- read_csv("http://hollywoodagegap.com/movies.csv") %>% 
  janitor::clean_names()

# Correct data
age_gaps_correct <- age_gaps %>% 
  mutate(
    across(ends_with("_birthdate"), ~as.Date(.)) # set dates to dates
  )
```

## üìã Exercise: Welche Rolle spielt das Geschlecht?

::: callout-note
## Spielt das Geschlecht eine Rolle?

-   Der folgende Abschitt befasst sich nun erg√§nzend mit der Frage, welche Rolle das Geschlecht mit Blick auf die "G√ºltigkeit" der vorherigen Ergebnisse spielt
-   Dazu sind jedoch weitere Explorations- und √úberarbeitungsschritte notwendig
:::

### √úbepr√ºfung der `_gender`-Variablen

::: callout-caution
## Exercise 1

Nutzen Sie die Funktion `sjmisc::frq()` und schauen Sie sich im Datensatz `age_gaps_correct` die Variablen `actor_1_gender` und `actor_2_gender` an.
:::

```{r exercise_1}
# INSERT CODE HERE
```

::: callout-caution
## Exercise 2

Nutzen Sie die Funktion `sjmisc::flat_talbe()` und den Datensatz `age_gaps_correct` um eine Kreuztabelle der Variablen `actor_1_gender` und `actor_2_gender` zu erstellen.
:::

```{r exercise_2}
# INSERT CODE HERE
```

### Sind die Daten "konsistent"?

#### √úberpr√ºfung der Sortierung

```{r table-check-variable-arrangement}
age_gaps_correct %>% 
  summarise(
      p1_older = mean(actor_1_age > actor_2_age), # older person first?
      p1_male  = mean(actor_1_gender == "man"),  # male person first? 
      p_1_first_alpha = mean(actor_1_name < actor_2_name) # alphabetical order?
  )
```

### √úberpr√ºfung der Anzahl pro Paare pro Film

```{r table-check-couple-numbers}
# Create data
couples <- age_gaps_correct %>% 
  group_by(movie_name) %>% 
  summarise(n = n()) 

# Distribution
couples %>% frq(n)

# Movies with a loot of couples 
couples %>% 
  filter(n > 3) %>% 
  arrange(desc(n))
```

### Korrekturen

```{r recoding-data-to-consistent}
age_gaps_consistent <- age_gaps_correct %>% 
  # If multiple couples, assign couple number by movie
  mutate(
      couple_number = row_number(),
      .by = "movie_name"
  ) %>% 
  # Change data structure (one line per actor in a coulpe of a movie)
  pivot_longer(
    cols = starts_with(c("actor_1_", "actor_2_")),
    names_to = c(NA, NA, ".value"),
    names_sep = "_"
  ) %>% 
  # Put older actor first
  arrange(desc(age_difference), movie_name, birthdate) %>% 
    mutate(
    position = row_number(),
    .by = c("movie_name", "couple_number")
  ) %>% 
  pivot_wider(
    names_from = "position",
    names_glue = "actor_{position}_{.value}",
    values_from = c("name", "gender", "birthdate", "age")
  ) %>% 
  mutate(
    couple_structure = case_when(
      actor_1_gender == "woman" & actor_2_gender == "woman" ~ 1,
      actor_1_gender == "man" & actor_2_gender == "man" ~ 2,
      actor_1_gender != "man" ~ 3, 
      actor_1_gender == "man" ~ 4,
    ),
    older_male_hetero  = sjmisc::rec(
      couple_structure, 
      rec="3=0; 4=1; ELSE=NA", 
      to.factor = TRUE
    )
  )

```

## Die zweite Datenexploration

### Alterskombinationen im √úberblick

::: callout-caution
## Exercise 3

Nutzen Sie die Funktion `sjmisc::frq()` und schauen Sie sich im Datensatz `age_gaps_consistent` die Variablen `couple_structure` und `older_male_hetero` an.
:::

```{r exercise_3}
# INSERT CODE HERE
```

### Wie sind die Altersunterschiede unterteilt, unter Ber√ºcksichtiung des Geschlechts?

#### Graphische √úberpr√ºfung

::: callout-caution
## Exercise 4

-   Erstellen Sie, auf Basis des Datensatzes `age_gaps_consistent`, einen `ggplot`.
-   Nutzen Sie im Argument `aes()` die Variable `age_difference` als `x`-Variable und `older_male_hetero` f√ºr das Argument `fill`.
-   Nutzen Sie `geom_bar` zur Erzeugung des Plots.
-   *Optional: Verwenden Sie `theme_pubr`*
:::

```{r exercise_4_1}
# INSERT CODE HERE
```

```{r exercise_4_2}
# INSERT CODE HERE
```

#### √úberpr√ºfung durch Modellierung

::: callout-caution
## Exercise 5

1. Erstellen Sie ein lineares Modell (`lm`), das die Variable `age_difference` als abh√§ngige Variable und die Variablen `release_year` und `older_male_hetero` als unabh√§ngige Variablen verwendet. Nutzen Sie dazu den Datensatz `age_gaps_consistent`.
2. Geben Sie die Parameter des Modells mit der Funktion `parameters::parameters()` aus.
3. Bewerten Sie die Modellleistung mit der Funktion `performance::model_performance()`.
4. Erstellen Sie einen Bericht √ºber das Modell mit der Funktion `report::report()`.
:::

```{r exercise_5}
# INSERT CODE HERE
```

